---
import BaseLayout from "./BaseLayout.astro";
import { formatDate, slugify } from "../lib/utils";

interface Props {
  title: string;
  publishDate: string;
  updatedDate?: string | null;
  author: string;
  description?: string | null;
  tags?: readonly string[];
  slug?: string;
}

const isDev = import.meta.env.DEV;
const { title, publishDate, updatedDate, author, description, tags, slug } = Astro.props;
---

<BaseLayout title={`${title} | Python Insider`} description={description ?? undefined}>
  <article class="prose mx-auto max-w-3xl">
    <header class="not-prose mb-10 animate-fade-up">
      <div class="flex items-start justify-between gap-4">
        <div class="min-w-0 flex-1">
          <h1 class="text-3xl font-bold leading-tight text-zinc-900 dark:text-zinc-100 sm:text-4xl" style="font-family: var(--font-display); letter-spacing: -0.02em;">
            {title}
          </h1>
        </div>
        {isDev && slug && (
          <a
            href={`/keystatic/collection/posts/item/${slug}`}
            class="edit-btn-always mt-2 flex-shrink-0 rounded-lg bg-zinc-100 p-2.5 text-zinc-400 hover:bg-amber-100 hover:text-amber-700 dark:bg-zinc-800 dark:text-zinc-600 dark:hover:bg-amber-900/30 dark:hover:text-amber-400"
            title="Edit in Keystatic"
          >
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg>
          </a>
        )}
      </div>

      <div class="mt-4 flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-zinc-500 dark:text-zinc-400">
        <a href={`/authors/${slugify(author)}`} class="font-medium text-zinc-800 hover:text-[#306998] dark:text-zinc-200 dark:hover:text-[#ffd43b] transition-colors">{author}</a>
        <span class="text-zinc-300 dark:text-zinc-600">/</span>
        <time datetime={publishDate}>{formatDate(publishDate)}</time>
        {updatedDate && (
          <>
            <span class="text-zinc-300 dark:text-zinc-600">&middot;</span>
            <span class="text-xs">Updated <time datetime={updatedDate}>{formatDate(updatedDate)}</time></span>
          </>
        )}
      </div>

      {tags && tags.length > 0 && (
        <div class="mt-5 flex flex-wrap gap-1.5">
          {tags.map((tag) => (
            <a
              href={`/tags/${tag}`}
              class="tag-pill rounded-md bg-zinc-100 px-2.5 py-1 text-xs font-medium text-zinc-600 dark:bg-zinc-700/60 dark:text-zinc-300"
            >
              {tag}
            </a>
          ))}
        </div>
      )}

      <div class="mt-8 h-px" style="background: linear-gradient(to right, rgba(48, 105, 152, 0.3), rgba(255, 212, 59, 0.2), transparent);"></div>
    </header>

    <div class="animate-fade-up stagger-2">
      <slot />
    </div>

    <footer class="not-prose mt-14 border-t border-zinc-200 pt-8 dark:border-zinc-700">
      <div class="flex items-center justify-between">
        <a
          href="/blog"
          class="group inline-flex items-center gap-2 text-sm font-medium text-[#306998] transition-colors hover:text-[#254f73] dark:text-[#ffd43b] dark:hover:text-[#f0c419]"
        >
          <span class="transition-transform group-hover:-translate-x-0.5">&larr;</span>
          Back to all posts
        </a>
        {isDev && slug && (
          <a
            href={`/keystatic/collection/posts/item/${slug}`}
            class="inline-flex items-center gap-1.5 rounded-lg bg-zinc-100 px-3 py-1.5 text-xs font-medium text-zinc-500 transition-colors hover:bg-amber-100 hover:text-amber-700 dark:bg-zinc-800 dark:text-zinc-400 dark:hover:bg-amber-900/30 dark:hover:text-amber-400"
          >
            <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg>
            Edit post
          </a>
        )}
      </div>
    </footer>
  </article>
</BaseLayout>
